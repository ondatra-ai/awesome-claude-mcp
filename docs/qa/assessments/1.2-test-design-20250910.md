# Test Design: Story 1.2 â€“ Railway Infrastructure Setup

Date: 2025-09-20
Designer: Quinn (Test Architect)

## Objectives
- Validate Railway environments (development, staging, production) are provisioned and linked to the repository.
- Ensure deployments via Railway CLI/GitHub Actions succeed for each environment.
- Verify custom domains (`dev.ondatra-ai.xyz`, `api.dev.ondatra-ai.xyz`, etc.) resolve to the correct Railway services.

## Test Scenarios

| ID | Area | Priority | Description | Expected Result |
|----|------|----------|-------------|-----------------|
| RLY-001 | Railway CLI | P0 | `railway environment development` followed by `railway up --service frontend-dev` completes without error | CLI deploy succeeds, new deployment appears in dashboard |
| RLY-002 | Railway CLI | P0 | Deploy `backend-dev` and hit `/health` | 200 response with healthy payload |
| RLY-003 | GitHub Actions | P0 | Workflow `deploy_to_railway.yml` triggered on `main` | `frontend-dev`/`backend-dev` redeployed, logs show success |
| RLY-004 | GitHub Actions | P1 | Manual dispatch with `deploy-env=Staging` | `frontend-staging`/`backend-staging` redeployed |
| RLY-005 | Domains | P0 | `dig dev.ondatra-ai.xyz` returns CNAME to Railway host | DNS points to Railway service domain |
| RLY-006 | Domains | P0 | `curl https://api.dev.ondatra-ai.xyz/health` | JSON healthy response |
| RLY-007 | Env Vars | P1 | `railway variables --service frontend-dev --environment development` shows `NEXT_PUBLIC_API_URL=https://api.dev.ondatra-ai.xyz` | Correct env vars per service |
| RLY-008 | Rollback | P2 | Re-run `railway up` with previous commit hash | Railway allows redeploying prior build |

## Tooling
- Railway CLI (`@railway/cli`)
- GitHub Actions workflow `.github/workflows/deploy_to_railway.yml`
- Standard networking tools (`curl`, `dig`)

## Exit Criteria
- All P0 scenarios pass for development environment
- DNS records verified for every custom domain
- GitHub workflow documented with run history showing latest successful deploys
- Runbook updated with manual deployment steps (`make deploy ENV=...`)

## Future Enhancements
- Add automated smoke tests hitting Railway domains post-deploy
- Integrate status notifications (Slack/Webhooks) for workflow runs
