# Yamale schema for docs/requirements.yml (Version 2.0 - Flattened Structure)
# Validates flattened scenario registry with implementation status tracking

metadata:
  title: str()
  version: str()
  last_updated: str()
  description: str(required=False)

# Flattened scenarios section - each scenario tracked independently
# Pattern: {LEVEL}-{sequence} (e.g., INT-001, E2E-002)
# Note: Story lineage tracked via user_stories.scenario_id field
scenarios: map(key=regex(r'^(?:INT|E2E)-\d{3}$'), val=include('scenario'))

---
# Include definitions

scenario:
  description: str()
  category: enum('backend', 'frontend', 'performance', 'integration')
  requirement: str()
  level: enum('integration', 'e2e')
  priority: enum('P0', 'P1', 'P2')
  acceptance_criteria: list(str(), min=1)
  implementation_status: include('implementation_status')
  last_updated: str()
  user_stories: list(include('user_story'), min=1)
  merged_steps: include('merged_steps')

implementation_status:
  status: enum('pending', 'implemented', 'failed', 'outdated')
  file_path: str()

user_story:
  story_id: str()
  story_file: str()
  scenario_id: str()
  merge_date: str()

merged_steps:
  given: list(any(str(), include('step_modifier')))
  when: list(any(str(), include('step_modifier')))
  then: list(any(str(), include('step_modifier')))

step_modifier:
  and: str(required=False)
  but: str(required=False)
