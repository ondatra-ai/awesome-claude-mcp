epic:
  id: 4
  name: "OAuth Authentication"
  status: "PLANNED"
  goal: "Implement complete Google OAuth 2.0 authentication flow with multi-account support"
  context: "Story 4.1 provides MVP authentication via Service Account for shared documents. Stories 4.2-4.6 extend to full user OAuth for personal document access."

stories:
  - id: "4.1"
    title: "Shared Document Editing"
    as_a: "Claude User"
    i_want: "Claude to edit Google Docs that I've shared with the service"
    so_that: "I can update my documents through natural conversation without manual copy-paste"
    status: "PLANNED"
    acceptance_criteria:
      - id: AC-1
        description: "When I share a Google Doc with the service account, Claude can modify it"
      - id: AC-2
        description: "When I ask Claude to update shared document content, the changes appear in Google Docs"
      - id: AC-3
        description: "When I try to edit an unshared document, I receive a clear message explaining how to share it"
      - id: AC-4
        description: "The service account email is visible so I know what to share with"

  - id: "4.2"
    title: "OAuth Configuration"
    as_a: "Developer/Maintainer"
    i_want: "to configure Google OAuth application"
    so_that: "users can authenticate with Google"
    status: "PLANNED"
    acceptance_criteria:
      - id: AC-1
        description: "Google Cloud project created"
      - id: AC-2
        description: "OAuth 2.0 credentials generated"
      - id: AC-3
        description: "Redirect URIs configured"
      - id: AC-4
        description: "Scopes defined for Google Docs access"
      - id: AC-5
        description: "Credentials stored as Railway environment variables (or external secret manager if required)"
      - id: AC-6
        description: "Environment variables configured"

  - id: "4.3"
    title: "OAuth Flow Implementation"
    as_a: "Claude User"
    i_want: "to authenticate with my Google account"
    so_that: "the service can access my documents"
    status: "PLANNED"
    acceptance_criteria:
      - id: AC-1
        description: "OAuth initiation endpoint created"
      - id: AC-2
        description: "Google consent screen displayed with permissions"
      - id: AC-3
        description: "Authorization code exchange implemented"
      - id: AC-4
        description: "Tokens received and validated"
      - id: AC-5
        description: "Error handling for auth failures"
      - id: AC-6
        description: "Success redirect to settings page"

  - id: "4.4"
    title: "Token Management"
    as_a: "Developer/Maintainer"
    i_want: "to securely manage OAuth tokens"
    so_that: "user sessions remain valid"
    status: "PLANNED"
    acceptance_criteria:
      - id: AC-1
        description: "Tokens encrypted before storage"
      - id: AC-2
        description: "Redis cache integration for tokens"
      - id: AC-3
        description: "Token refresh logic implemented"
      - id: AC-4
        description: "Expiry handling automated"
      - id: AC-5
        description: "Token retrieval by user ID"
      - id: AC-6
        description: "Secure token deletion capability"

  - id: "4.5"
    title: "Multi-Account Support"
    as_a: "Claude User"
    i_want: "to connect multiple Google accounts"
    so_that: "I can edit documents from different accounts"
    status: "PLANNED"
    acceptance_criteria:
      - id: AC-1
        description: "Support multiple tokens per user"
      - id: AC-2
        description: "Account selection mechanism"
      - id: AC-3
        description: "Account switching capability"
      - id: AC-4
        description: "Display connected accounts"
      - id: AC-5
        description: "Remove account functionality"
      - id: AC-6
        description: "Default account designation"

  - id: "4.6"
    title: "Authentication Error Handling"
    as_a: "Claude User"
    i_want: "clear authentication error messages"
    so_that: "I can resolve authentication issues"
    status: "PLANNED"
    acceptance_criteria:
      - id: AC-1
        description: "Structured error responses for auth failures"
      - id: AC-2
        description: "Token refresh failure handling"
      - id: AC-3
        description: "Clear error codes and messages"
      - id: AC-4
        description: "Guidance for resolution steps"
      - id: AC-5
        description: "Logging of auth errors"
      - id: AC-6
        description: "Immediate error return without retry"

dependencies: []

success_criteria: []

technical_notes:
  - "Story 4.1 uses Service Account for MVP - no user OAuth flow required"
  - "Service Account requires documents to be explicitly shared by user"
  - "Migration to OAuth (4.2-4.6) uses same Google Docs API calls - only auth layer changes"
